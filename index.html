<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para mi chanchito❤️</title>
    
    <!-- Cargamos React y Tailwind directamente para que funcione sin instalar nada -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Estilos para animaciones suaves -->
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }

        /* Animación suave para el ícono de refrescar */
        .spin-hover:hover svg {
            transform: rotate(180deg);
            transition: transform 0.5s ease;
        }
    </style>
</head>
<body class="bg-pink-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Iconos (SVG inline para no depender de librerías externas) ---
        const IconHeart = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
        );
        const IconUpload = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        );
        
        // CAMBIO: Ícono de RESTART REAL (Dos flechas en círculo)
        const IconRestart = ({ size = 24, className = "" }) => (
             <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" />
                <path d="M3 3v9h9" />
                <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 12" />
                <path d="M21 21v-9h-9" />
            </svg>
        );
        const IconArrowLeft = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        );
        const IconStar = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        );
        const IconGrid = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
        );
        const IconCheck = ({ size = 24, className="" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        );

        // --- Componentes UI ---
        const Button = ({ children, onClick, variant = 'primary', className = '', icon: Icon }) => {
            const baseStyle = "flex items-center justify-center gap-2 px-6 py-3 rounded-full font-medium transition-all duration-300 transform hover:scale-105 shadow-md active:scale-95 group"; 
            const variants = {
                primary: "bg-rose-400 hover:bg-rose-500 text-white shadow-rose-200",
                secondary: "bg-white hover:bg-rose-50 text-rose-500 border-2 border-rose-200",
                outline: "border-2 border-white text-white hover:bg-white/20"
            };

            return (
                <button onClick={onClick} className={`${baseStyle} ${variants[variant]} ${className}`}>
                    {Icon && <Icon size={20} className="transition-transform duration-500 group-hover:rotate-180" />}
                    {children}
                </button>
            );
        };

        // --- Aplicación Principal ---
        function App() {
            const [images, setImages] = useState([]);
            const [gameState, setGameState] = useState('welcome'); 
            const [currentImage, setCurrentImage] = useState(null);
            const [difficulty, setDifficulty] = useState(3);
            const [tiles, setTiles] = useState([]);
            const [selectedTile, setSelectedTile] = useState(null);
            const [isSolved, setIsSolved] = useState(false);
            const [moves, setMoves] = useState(0);
            const [aspectRatio, setAspectRatio] = useState(1);

            // Cargar imágenes
            const handleImageUpload = (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                const newImages = files.map(file => URL.createObjectURL(file));
                setImages(prev => [...prev, ...newImages]);
                if (gameState === 'welcome') setGameState('gallery');
            };

            // Iniciar juego con corrección de aspecto
            const startGame = (img, level) => {
                const imageObj = new Image();
                imageObj.src = img;
                imageObj.onload = () => {
                    // Evitar división por cero
                    const ratio = imageObj.height > 0 ? imageObj.width / imageObj.height : 1;
                    setAspectRatio(ratio);
                    setCurrentImage(img);
                    setDifficulty(level);
                    setGameState('playing');
                    setMoves(0);
                    setIsSolved(false);
                    generateTiles(level);
                };
            };

            // Generar piezas
            const generateTiles = (gridSize) => {
                const totalTiles = gridSize * gridSize;
                const newTiles = Array.from({ length: totalTiles }, (_, index) => ({
                    id: index,
                    currentPos: index,
                }));
                
                // Barajar asegurando que no quede resuelto de casualidad
                let shuffled;
                do {
                    shuffled = [...newTiles].sort(() => Math.random() - 0.5);
                } while (shuffled.every((tile, i) => tile.id === i));

                const finalTiles = newTiles.map((tile, i) => ({
                    ...tile,
                    currentPos: i,
                    contentId: shuffled[i].id
                }));

                setTiles(finalTiles);
                setSelectedTile(null);
                setIsSolved(false);
                setMoves(0);
            };

            // Click en pieza
            const handleTileClick = (index) => {
                if (isSolved) return;

                if (selectedTile === null) {
                    setSelectedTile(index);
                } else {
                    if (selectedTile === index) {
                        setSelectedTile(null); // Deseleccionar
                        return;
                    }
                    
                    const newTiles = [...tiles];
                    // Intercambio simple
                    const tempContent = newTiles[index].contentId;
                    newTiles[index].contentId = newTiles[selectedTile].contentId;
                    newTiles[selectedTile].contentId = tempContent;

                    setTiles(newTiles);
                    setSelectedTile(null);
                    setMoves(m => m + 1);
                    checkWin(newTiles);
                }
            };

            const checkWin = (currentTiles) => {
                const win = currentTiles.every(tile => tile.id === tile.contentId);
                if (win) {
                    setIsSolved(true);
                    setTimeout(() => setGameState('won'), 1500);
                }
            };

            // --- VISTAS ---

            if (gameState === 'welcome') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden">
                        {/* Fondo animado */}
                        <div className="absolute top-10 left-10 text-rose-200 animate-pulse-slow"><IconHeart size={64} className="fill-current" /></div>
                        <div className="absolute top-10 right-10 text-rose-200 animate-pulse-slow"><IconHeart size={64} className="fill-current" /></div>
                        <div className="absolute bottom-10 right-10 text-rose-200 animate-bounce"><IconHeart size={48} className="fill-current" /></div>
                        <div className="absolute bottom-10 left-10 text-rose-200 animate-bounce"><IconHeart size={48} className="fill-current" /></div>
                        
                        <div className="bg-white p-8 rounded-3xl shadow-xl max-w-md w-full text-center z-10 border-4 border-rose-100">
                            <div className="mx-auto bg-rose-100 w-20 h-20 rounded-full flex items-center justify-center mb-6 text-rose-500">
                                <IconHeart size={40} className="fill-current" />
                            </div>
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Rompecabezas Amorchin</h1>
                            <p className="text-gray-500 mb-8">Un pequeño jueguito hecho con mucho amor para mi gordo ❤️</p>
                            
                            <label className="block w-full cursor-pointer">
                                <div className="bg-rose-400 hover:bg-rose-500 text-white py-4 rounded-xl flex items-center justify-center gap-2 transition-colors shadow-lg shadow-rose-200 transform hover:scale-105 active:scale-95 duration-200">
                                    <IconUpload size={24} />
                                    <span className="font-semibold text-lg">Subir nuestras fotitos</span>
                                </div>
                                <input type="file" multiple accept="image/*" onChange={handleImageUpload} className="hidden" />
                            </label>
                            <p className="text-xs text-gray-400 mt-4">Soy vago y no hice base de datos, las fotitos no se van a guardar son privadas.</p>
                        </div>
                    </div>
                );
            }

            if (gameState === 'gallery') {
                return (
                    <div className="min-h-screen p-6">
                        {/* Fondo animado */}
                        <div className="absolute top-10 left-10 text-rose-200 animate-pulse-slow"><IconHeart size={64} className="fill-current" /></div>
                        <div className="absolute top-10 right-10 text-rose-200 animate-pulse-slow"><IconHeart size={64} className="fill-current" /></div>
                        <div className="absolute bottom-10 right-10 text-rose-200 animate-bounce"><IconHeart size={48} className="fill-current" /></div>
                        <div className="absolute bottom-10 left-10 text-rose-200 animate-bounce"><IconHeart size={48} className="fill-current" /></div>
                        
                        <div className="max-w-4xl mx-auto">
                            <header className="flex items-center justify-between mb-8">
                                <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                    <span className="text-rose-500"><IconHeart className="fill-current" /></span> Elige una foto
                                </h2>
                                <label className="cursor-pointer bg-white text-rose-500 px-4 py-2 rounded-full text-sm font-medium shadow-sm border border-rose-200 hover:bg-rose-50 transition-colors flex items-center gap-2">
                                    <IconUpload size={16} /> Agregar más
                                    <input type="file" multiple accept="image/*" onChange={handleImageUpload} className="hidden" />
                                </label>
                            </header>

                            {images.length === 0 ? (
                                <div className="text-center py-20 bg-white/50 rounded-3xl border-2 border-dashed border-rose-200">
                                <p className="text-gray-400">No hay fotos todavía...</p>
                                </div>
                            ) : (
                                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                                {images.map((img, idx) => (
                                    <div key={idx} className="group relative bg-white p-3 rounded-2xl shadow-md hover:shadow-xl transition-all transform hover:-translate-y-1">
                                    <div className="aspect-square rounded-xl overflow-hidden mb-4 relative bg-gray-100">
                                        <img src={img} alt="memory" className="w-full h-full object-cover" />
                                        <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white font-medium">
                                        Jugar con esta
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        <p className="text-sm text-center text-gray-500 font-medium mb-2">Dificultad:</p>
                                        <div className="flex justify-between gap-2">
                                        <button onClick={() => startGame(img, 3)} className="flex-1 py-2 text-xs bg-rose-100 text-rose-600 rounded-lg hover:bg-rose-200 transition-colors">Fácil</button>
                                        <button onClick={() => startGame(img, 4)} className="flex-1 py-2 text-xs bg-rose-100 text-rose-600 rounded-lg hover:bg-rose-200 transition-colors">Medio</button>
                                        <button onClick={() => startGame(img, 5)} className="flex-1 py-2 text-xs bg-rose-100 text-rose-600 rounded-lg hover:bg-rose-200 transition-colors">Difícil</button>
                                        </div>
                                    </div>
                                    </div>
                                ))}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (gameState === 'won') {
                return (
                    <div className="min-h-screen bg-rose-500 flex flex-col items-center justify-center p-4 text-white text-center">
                        <div className="animate-bounce mb-6">
                            <IconStar size={80} className="text-yellow-300 fill-current" />
                        </div>
                        <h1 className="text-4xl md:text-6xl font-bold mb-4 font-serif">¡Te Amo!</h1>
                        <p className="text-xl md:text-2xl mb-8 max-w-lg opacity-90">
                            Armaste nuestro recuerdo a la perfección ❤️ Gracias por jugar este mini juego, sos la mejor pieza de mi vida.
                        </p>
                        <div className="bg-white/20 backdrop-blur-sm p-4 rounded-2xl mb-8">
                            <img src={currentImage} alt="Completed" className="w-64 h-auto object-contain rounded-xl shadow-2xl rotate-2 border-4 border-white max-h-64" />
                        </div>
                        <div className="flex gap-4">
                            <Button variant="outline" onClick={() => setGameState('gallery')} icon={IconArrowLeft}>
                                Elegir otra
                            </Button>
                            {/* Botón corregido con ícono horario y animación */}
                            <Button variant="secondary" onClick={() => startGame(currentImage, difficulty)} icon={IconRestart}>
                                Jugar de nuevo
                            </Button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex flex-col items-center py-6 px-4">
                    {/* Header */}
                    <div className="w-full max-w-lg flex items-center justify-between mb-6">
                        <button onClick={() => setGameState('gallery')} className="p-2 bg-white rounded-full text-gray-600 hover:bg-gray-100 shadow-sm transition-colors">
                            <IconArrowLeft size={20} />
                        </button>
                        <div className="flex items-center gap-4 bg-white px-4 py-2 rounded-full shadow-sm">
                            <span className="text-rose-500 font-bold flex items-center gap-1"><IconGrid size={16}/> {moves} movs</span>
                            <span className="w-px h-4 bg-gray-200"></span>
                            <span className="text-gray-500 text-sm font-medium">{difficulty === 3 ? 'Fácil' : difficulty === 4 ? 'Medio' : 'Difícil'}</span>
                        </div>
                        <button 
                            onClick={() => generateTiles(difficulty)} 
                            className="p-2 bg-white rounded-full text-rose-500 hover:bg-rose-50 shadow-sm transition-colors spin-hover" 
                            title="Reiniciar tablero"
                        >
                            <IconRestart size={20} className="transition-transform duration-500" />
                        </button>
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center w-full max-w-2xl">
                        <h2 className="text-2xl font-bold text-rose-900 mb-6 text-center font-serif">
                            {isSolved ? "¡Lo lograste!" : "Arma nuestra foto ❤️"}
                        </h2>

                        {/* Contenedor del Tablero */}
                        <div 
                            className="relative bg-white p-2 rounded-xl shadow-2xl shadow-rose-200/50 transition-all duration-300"
                            style={{
                                width: '100%',
                                maxWidth: '500px',
                                aspectRatio: aspectRatio,
                                maxHeight: '65vh',
                                margin: '0 auto'
                            }}
                        >
                            <div 
                                className="w-full h-full grid bg-rose-100 rounded-lg overflow-hidden border border-rose-100 select-none"
                                style={{
                                    gridTemplateColumns: `repeat(${difficulty}, 1fr)`,
                                    gridTemplateRows: `repeat(${difficulty}, 1fr)`,
                                    gap: '1px'
                                }}
                            >
                                {tiles.map((tile, index) => {
                                    const row = Math.floor(tile.contentId / difficulty);
                                    const col = tile.contentId % difficulty;
                                    const isSelected = selectedTile === index;
                                    
                                    return (
                                        <div
                                            key={index}
                                            onClick={() => handleTileClick(index)}
                                            className={`
                                                relative cursor-pointer overflow-hidden
                                                ${isSelected ? 'ring-2 ring-rose-400 z-10 scale-95 shadow-lg' : 'hover:brightness-110'}
                                                ${isSolved ? 'ring-0 scale-100' : ''}
                                            `}
                                            style={{
                                                transition: 'transform 0.2s, filter 0.2s',
                                                zIndex: isSelected ? 20 : 1
                                            }}
                                        >
                                            <div 
                                                style={{
                                                    width: `${difficulty * 100}%`,
                                                    height: `${difficulty * 100}%`,
                                                    backgroundImage: `url(${currentImage})`,
                                                    backgroundSize: '100% 100%',
                                                    position: 'absolute',
                                                    left: `-${col * 100}%`,
                                                    top: `-${row * 100}%`,
                                                    pointerEvents: 'none'
                                                }}
                                            />
                                            {/* Borde interno estético */}
                                            <div className="absolute inset-0 border border-white/20 pointer-events-none"></div>

                                            {/* Indicador de éxito sutil */}
                                            {isSolved && (
                                                <div className="absolute inset-0 bg-green-500/10 flex items-center justify-center animate-pulse">
                                                    <IconCheck className="text-white drop-shadow-md" size={24}/>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Miniatura Referencia */}
                        {!isSolved && (
                            <div className="mt-8 flex flex-col items-center opacity-80 hover:opacity-100 transition-opacity">
                                <p className="text-xs text-gray-400 mb-2 uppercase tracking-wide">Referencia</p>
                                <div className="w-20 h-20 rounded-lg overflow-hidden shadow-md border-2 border-white ring-1 ring-rose-100">
                                    <img src={currentImage} className="w-full h-full object-cover" alt="Ref" />
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>